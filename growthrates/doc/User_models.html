<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Thomas Petzoldt" />

<meta name="date" content="2022-10-03" />

<title>Estimation of Growth Rates with Package growthrates, Part 2: User-defined Growth Models</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Estimation of Growth Rates with Package
<code>growthrates</code>, Part 2: User-defined Growth Models</h1>
<h4 class="author">Thomas Petzoldt</h4>
<h4 class="date">2022-10-03</h4>



<!--
possible output options are:
rmarkdown::pdf_document
rmarkdown::html_vignette

set to UTF if necessary with:
%\VignetteEncoding{UTF-8}

Bibliographies may need to set the LANG environment variable
LANG=en_US.UTF-8
-->
<div id="introduction" class="section level1">
<h1>1. Introduction</h1>
<p>Package <strong>growthrates</strong> comes with a set of pararametric
growth models built-in, that should be sufficient for many application
scenarios, but of course not under all circumstances. This document
describes how the set of available functions can be extended with own
user-defined models. Section (3) describes how simple regression
functions existing in a <em>closed form</em> can be implemented. In
Section (4) we will see how growth models defined by systems of ordinary
differential equations (ODE) can be implemented directy in R and finally
Section (5) describes how ODE models can be implemented as C inline
functions.</p>
</div>
<div id="differential-equations-or-closed-form" class="section level1">
<h1>2. Differential equations or closed form?</h1>
<p>Growth models can be either “ordinary functions” of time <span class="math inline">\(f(t)\)</span> in <em>closed form</em>, that a
allow to get values for the dependend variable <span class="math inline">\(y\)</span> immediately from any given value of an
independent variable <span class="math inline">\(t\)</span> (or <span class="math inline">\(time\)</span>) without the need of iteration. Or,
they can be a differential equation model <span class="math inline">\(dy/dt\)</span> that needs numerical
integration.</p>
<p>Sometimes, a model can be given in either of these forms. As an
example, the logistic growth model can be written as a differential
equation:</p>
<p><span class="math display">\[\frac{dy}{dt} = \mu_{max} \cdot y
\left(1 - \frac{y}{K}\right)\]</span></p>
<p>or as its analytical solution in closed form:</p>
<p><span class="math display">\[y(t) = \frac{K \cdot y_0}{y_0 + (K -
y_0) \cdot e^{-\mu_{max} \cdot t}}\]</span></p>
<p>We see, that it is much easier to use the second form, because <span class="math inline">\(y\)</span> can immediately be calculated from
<span class="math inline">\(t\)</span>, while for the first version, we
would need either calculus (and get the second form as its solution), or
we could use a numerical method to simulate the evolution of <span class="math inline">\(y\)</span> stepwise over time.</p>
<p>But on the other hand, models given as differential equations are
often more directly related to a mechanistic process description and
easier to extended.</p>
</div>
<div id="growth-models-in-closed-form" class="section level1">
<h1>3. Growth models in closed form</h1>
<p>Let’s assume we want to extend the logistic growth model with an
additional shift parameter in <span class="math inline">\(y\)</span>
direction, for example, because a part of the population does not
participate growing. This leads to an equation like:</p>
<p><span class="math display">\[y(t) = \frac{K \cdot y_0}{y_0 + (K -
y_0) \cdot e^{-\mu_{max} t}} + y_{shift}\]</span></p>
<p>After loading package growthrates:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;growthrates&quot;</span>)</span></code></pre></div>
<p>we can immediately define our own function in the user workspace,
without modifying the package itself. In order to make it compatible
with package growthrates, it is sufficient to streamline the input and
output interfaces in the style described in help page
<code>?growthmodel</code>.</p>
<p>The function can have any valid name, but:</p>
<ol style="list-style-type: decimal">
<li>it must have exactly two arguments <strong>time</strong> and
<strong>parms</strong> as input and</li>
<li>its return value (output) must be a matrix with at least 2 columns
with the column names <code>time</code> and <code>y</code>.</li>
</ol>
<p>The inner part of the function can be adapted as necessary, as long
as the connection between input and output makes sense from a scientific
viewpoint.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>grow_logistic_yshift <span class="ot">&lt;-</span> <span class="cf">function</span>(time, parms) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(parms), {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> (K <span class="sc">*</span> y0) <span class="sc">/</span> (y0 <span class="sc">+</span> (K <span class="sc">-</span> y0) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>mumax <span class="sc">*</span> time)) <span class="sc">+</span> y_shift</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(<span class="at">time =</span> time, <span class="at">y =</span> y))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The, at a first look, circumstantial
<code>as.matrix(data.frame(()))</code> construction is just a simple way
to create the required output format.</p>
<p>Then it is of course wise to test the function beforehand, for
example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">grow_logistic_yshift</span>(time, <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">y0 =</span> <span class="dv">1</span>, <span class="at">mumax =</span> <span class="fl">0.5</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">y_shift =</span> <span class="dv">2</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time, out[, <span class="st">&quot;y&quot;</span>], <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Future versions of the growthrates package may introduce additional
checks, so it is already a good idea to convert the function into an
appropriate object of class <code>growthmodel</code> with a so-called
constructor function of the same name:</p>
<pre><code>grow_logistic_yshift &lt;- growthmodel(grow_logistic_yshift,
                                    c(&quot;y0&quot;, &quot;mumax&quot;, &quot;K&quot;, &quot;y_shift&quot;))</code></pre>
<p>Now the new model is ready to be fitted to test data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.1</span>, <span class="fl">2.3</span>, <span class="dv">5</span>, <span class="fl">4.7</span>, <span class="fl">4.3</span>, <span class="fl">6.9</span>, <span class="fl">8.2</span>, <span class="fl">11.5</span>, <span class="fl">8.8</span>, <span class="fl">10.2</span>, <span class="fl">14.5</span>, <span class="fl">12.5</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="fl">13.6</span>, <span class="fl">12.7</span>, <span class="fl">14.2</span>, <span class="fl">12.5</span>, <span class="fl">13.8</span>, <span class="fl">15.1</span>, <span class="fl">12.7</span>, <span class="fl">14.9</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_growthmodel</span>(grow_logistic_yshift,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="fu">c</span>(<span class="at">y0 =</span> <span class="dv">1</span>, <span class="at">mumax =</span> <span class="fl">0.1</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">y_shift =</span> <span class="dv">1</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">time =</span> x, <span class="at">y =</span> y)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAGACAMAAABC/kH9AAAAVFBMVEUAAAAAADoAAGYAAP8AOjoAOpAAZrY6AAA6ADo6AGY6kNtmAABmtrZmtv+QOgCQZgCQ2/+2ZgC2/7a2///bkDrb/7bb////tmb/25D//7b//9v///93RBbeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAALP0lEQVR4nO2dfX+6OBZHaTttZ+rWrVvmR9X3/z6XB1ErDwLJleSbc/5wZ/YjF4bT5N5EQrIjSJOtfQFgC4LFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweIgWBwEi4NgcRAsDoLFQbA4CBYHweJ4FpzBg1hLsN9wMASCxUGwOAgWB8FxMaNqOh3g/YurhEuF7Dj31iE4JrKrz1mH+PziKuESYZLg3704gmNiiuCbXhzBUXE/B9/+DSA4Lu5W0QgWB8HqkIOdmT3Z8Fiooh2ZP9mwJqaCf94/fYYLgwWTDWtiIni/ufze/PztHC4sEFxSZB/V/9CCRwM9JJUbddH7zesfUcG+cvCDUrlZDt49fYkK9tP0HtXT2xVZefYhKtgL8Qsu2+9fCB5EQPDxsM0QPEjsOXggyuzHdXWZcBMm36eXX/wKMflypn5xlXCaXDfyl1HGY0w+mUcQPM4MheMwk2XDoiR049NLHWbTgg/bAa/LwsXHnApqsJUGLLg0/OYzXGxMUTMxf7reKKscXAyPkJaEi4xRwTOSqofRBkWWBUOCncoll0vx+cVVwoVGp3N1K4Udr8TvF1cJFxzXnetKak8X4v2Lq4QLlbXa7QUE27G22xoEm7B+y21BsHeCcVuDYL8EJbcCwT4Jze4RwR4Zb7xWP4Hfi4tgP9zrmq2e37gbF8E+uNs1Wz2BdT8ugp0pG+/sVbv9X5rfiyPYnKrx3u9/pwhe0osj2Ji6b/Zjb1kvTg42pC2s/PS/C9M0VbQVl8LKTwVlVIcheCHXdbOfMZDNSArBi7gZF/mZxTCZC0HwAgKckRwEwXMJ7ueEcRA8j7jsHhE8k9j0Plxw3KsLo2u+R1rwDGLUi+DpRKkXwZOJ1G/ygqdWA3H2z8fkBU+cHoxWb+qCp03wR6wXwZfPQWLWi+DL5wBRN99j6oLv5+DI9SYv+F4VHb3f5AWPE79fBI8Qe/qtQfAQEnoRPIiGXgQPoeIXwf2I9M9HBPcjoxfBvQj5RXAPSn4R3EEn/dYYCT5sR98WHbBgLb1WgvNm57PzFmiO4R6Iml8bwYftWWte7YDmGO6B9PmN9BnfEyaC95vzy6KLqF7p3+v3GOrVToIWfMWQ30AvdxJWOfjUhKPKwb35F8G9tPuuDLTfIO9Yf32FYOPzPoyh+pkcPOt0wS4+Gx4fBXixM6AFN8iNf1sQXCE2PXmN0Tg4rq3tdPVateC4trZT9mv3Y0NEW9sheNYXGyLa2k7aL0WWcH1Vk7pgcb3JC5b3i2B10has7zdtwQn4TVpwCn4TFqw+PjqRrODBn3+j/nGwS6qCRX/e74LgX8T+gE6X+YL3m+zODwlez2vDWANe/eK8sqQF52WeGnhY0v95TRisrxB8wtnxqvdwpH4mB7fkY0vLPJ7XgNHxEVV0RVHehs/jYTv42LO/8/onjfFvywLB1RNXjdmhhUc+z+udRCY4WpZU0U9fDzyvV8qOJy29iY2Dy5O+aGXY+6QkOKvzb2KGjQTvsuytfo3D0KN36wi+bOecDEbLR8sibFdNeO03AS0fRbCXLx5PC8CLuhYLagF4gn6tlq58tmOom5HUqqsLX+RmMSaQUAtObYDUYJyDr97W4RDOC2n6TaeKTtRvOuNgBPv64irh7pKq30QEJ/YDwzVJCE5XbxqCU/aLYHUSEJy03wQEp+1XX3DifrUFJ/iETgdlwSk+odNBWHB1ipfkfv+9RVtweo9gdZAWnOITHLcIC8ZvhbDgJJ/Q6aArOPkBUoOsYPw2qArG7wlRwfht0RSM3zOSgvF7weqx2efv4897lg0uJUbwg7ARXPv9++vXPqQO4WaC3yuM1iZ9lJLrt2k9fulKwk9Q9mG2+Oy0aOXhi8/Q+xujLrpsvfkqLRi/N9gI3m+ev6+WGLqGmw5+b7EaJhVNRzz4VksbwfjtoDUORnAHKcH47SIkmPFRHzqC0duLjGD89oNgcVQE43cADcHUV4PEInh09hq9w0QiOBs7BL8jxCE4GzuG/nmM+AWjd5RoBbdJGb/jxCG4m4Pb/wO/d4hE8G0V3TZp/N4jFsG9h/OChvvELJjyeQKRCq6X77M2dAKxCi6759sQrAbuI1rBnf55dLIrXWIV3Em/o5NdCROp4G55heB+4hTcUz4juB9TwT/vQ3tyOJnoHx6Rg3sxWpt0WYM0sMWwg4qh0S9VdB82LbjI6pVnJi2Y2Y1ZGHXR+0216Kwr2H11IX7nYZaDd09fBi2Y2cm52BVZefbhXTB6Z2NYRf+8/+VZMH7nYzlMOmwHty5cJBi/C4hnooP0u4hYBKN3IXEIRu9iohCM3uVEIJjm60L4gtHrRPCC8etG6ILx60jYgkm/zgQs+AW9HghWMHb9EKhg9PoiTMHo9UaIgmm+HglPMHq9Epxg9PolKMEvjIy8E5Lgi1wecfZGOIKvGi+LFPwRiOBffTPLjDwShOCbxdwI9oiR4LzMovUTlfmEtUm3PTKCPWIjOH/6Ou431ZYrEwR3fZKD/WEiuNn17LB9/bNMMFW0P4yWjzYPvO9e/+T3t7ajR7bEsAUfqy3uluRg8IhRDj5p3W8mLQCnR7bDrIpuOunD1v8Kf5hDEONgsAPB4iBYnNUEw4NYSbA7ni7IT5iQoiwMg+BYoiDYIExIURBsECakKAg2CBNSFAQbhAkpCoINwoQUBcEGYUKKgmCDMCFFUREMfkGwOAgWB8HiIFgcBIuDYHEQLA6CxUGwOAgWB8HiIFicYAQftlnWbI1YZNnTl0uoXbX/nluYn/cse3O+mPN6eYcoP/98/4owN1Qogg/b8rLz6qYW5T8ULoaLrBLsFKYoI9Qr3Z2iVOvli8qwQ5T9pl4Fdo4wO1Qogpvt8vLn72aN6u5tcaT9phLsFKY52PViDtu35mCHKEWzke85wvxQoQhuKP82z6aXxshf/1sKdgrz8/epiThFOQteHqXIPorqsHOE+aHCErwr/xPqm1ssFlweX+VgpzDF8/82dUHgdjFtF+14Ld9X1zE/VFCCqw2omwSzOO9VfVgl2ClMXvWLVQN0vJhTQeQUpZZ5jjA/VEiCi7bGcrineSnXXfDTqZ24XUzZH5Wdq+PfrJDgZgN5t16xPtq5i25yXJnvnKJcEidddEXejILdiqz8tLjy0ylMcwPLm+kWpW1t7teiUGRdXv/hOExqWrBTmOZ9UYXjMKmR4RqlEBkmVbmqwXmio5nJcpuiaP9EnKK0OdgpSiEy0XHqW6tLz/1MVTqFKdp5U6coOw9RTvn2HGFuqFAEgxEIFgfB4iBYHASLg2BxECwOgsVBsDgIFgfB4iBYHASLg2BxECwOgsVBsDgIFgfB4iBYHASLg2BxECwOgsVBsDgIFgfB4qQpuPg8rSDUJ0nBqcitQLA4KQquXmP3+m8p+ef9P9XbdKp/rxfOt6s9lUhRcN2C97Xg+vV6z9/1SxGqV69c1qGrkLjgj2P78bnfVG6Xv6ArUBIX/Hk8fzQvRmherCEEgs+C2xf0rH11fkHw7xYsB4LbD9GxU6KCP7qCmxcY7tTacZKCj7t2HHwtuB4HqxXRiQpOCASLg2BxECwOgsVBsDgIFgfB4iBYHASLg2BxECwOgsVBsDgIFgfB4iBYHASLg2BxECwOgsVBsDgIFgfB4vwfJEjjYVzTU5sAAAAASUVORK5CYII=" /><!-- --></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Parameters:
##         Estimate Std. Error t value Pr(&gt;|t|)    
## y0       0.86510    1.15526   0.749 0.464826    
## mumax    0.08134    0.02737   2.972 0.008995 ** 
## K       12.99885    2.56970   5.059 0.000116 ***
## y_shift  1.04939    2.22481   0.472 0.643528    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.248 on 16 degrees of freedom
## 
## Parameter correlation:
##              y0   mumax       K y_shift
## y0       1.0000 -0.9632  0.9555 -0.9477
## mumax   -0.9632  1.0000 -0.8989  0.8519
## K        0.9555 -0.8989  1.0000 -0.9766
## y_shift -0.9477  0.8519 -0.9766  1.0000</code></pre>
</div>
<div id="differential-equation-models-in-r" class="section level1">
<h1>4. Differential equation models in R</h1>
<p>Differential equation models can be used quite similar to this. It is
a little bit more complex because:</p>
<ol style="list-style-type: decimal">
<li>we need two functions. One for the ODE model (the derivatives) and
one for the numerical integration.</li>
<li>the ODE model distinguishes between time dependent <em>state
variables</em> and constant <em>parameters</em>, that can both be
considered as <em>parameters</em> in a statistical sense. This
distinction between <strong>statistical parameters</strong> (from the
viewpoint of model fitting) and <strong>ODE model parameters</strong>
should not be confused.</li>
<li>the numerical integration itself is a broad field that needs
experience and care. A short overview on this topic can be found in
<span class="citation">Soetaert, Petzoldt, and Setzer
(2010)</span>.</li>
</ol>
<p>In the following, let’s assume a model where the carrying capacity is
a function of time. This can be modelled with a system of two
differential equations, one for the carrying capacity (<span class="math inline">\(K\)</span>) and another for the population
abundance (<span class="math inline">\(y\)</span>). For sake of
simplicity we assume a linear increase of <span class="math inline">\(K\)</span>, but more complex models are of course
also possible, e.g. biochemical conversion of a mixed substrate,
Monod-dependency from a limited resource, density dependence or a
semi-continuos addition of nutrients.</p>
<p>The growth model is built from two parts:</p>
<ol style="list-style-type: decimal">
<li>the function <code>ode_...</code> with the differential equations,
and</li>
<li>the growth model <code>grow_...</code> calculating the numerical
solution.</li>
</ol>
<p>In the latter, the statistical parameters are splitted into the
initial values for the states (<code>init</code>) and the ODE model
parameters. And, we need to distinguish between the initial (start)
values, e.g. <span class="math inline">\(y_0\)</span> and the state
variables <span class="math inline">\(y\)</span> that change during
simulation.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ode_K_linear <span class="ot">&lt;-</span> <span class="cf">function</span> (time, init, parms, ...) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(parms, init)), {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    dy <span class="ot">&lt;-</span> mumax <span class="sc">*</span> y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> y<span class="sc">/</span>K)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    dK <span class="ot">&lt;-</span> dK</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(dy, dK))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>grow_K_linear <span class="ot">&lt;-</span> <span class="cf">function</span>(time, parms, ...) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  init    <span class="ot">&lt;-</span> parms[<span class="fu">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>)]           <span class="co"># initial values</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(init) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;K&quot;</span>)               <span class="co"># force names of state variables</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  odeparms <span class="ot">&lt;-</span> parms[<span class="fu">c</span>(<span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;dK&quot;</span>)]      <span class="co"># the parms of the ODE model</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">ode</span>(init, time, ode_K_linear, <span class="at">parms =</span> odeparms)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Again, it’s a good idea to test this first:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>grow_K_linear <span class="ot">&lt;-</span> <span class="fu">growthmodel</span>(grow_K_linear,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pnames =</span> <span class="fu">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;deltaK&quot;</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">grow_K_linear</span>(<span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">c</span>(<span class="at">y0 =</span> .<span class="dv">1</span>, <span class="at">K =</span> <span class="dv">1</span>, <span class="at">mumax =</span> <span class="fl">0.1</span>, <span class="at">dK =</span> <span class="fl">0.5</span>)))</span></code></pre></div>
<pre><code>##      time         y   K
## [1,]    1 0.1000000 1.0
## [2,]    2 0.1095851 1.5
## [3,]    3 0.1203149 2.0
## [4,]    4 0.1322238 2.5
## [5,]    5 0.1453939 3.0
## [6,]    6 0.1599322 3.5</code></pre>
<p>before we fit the model to data:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">2.2</span>, <span class="fl">3.1</span>, <span class="fl">1.5</span>, <span class="fl">8.9</span>, <span class="dv">8</span>, <span class="fl">8.4</span>, <span class="fl">9.8</span>, <span class="fl">9.3</span>, <span class="fl">10.6</span>, <span class="dv">12</span>, <span class="fl">13.6</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">13.1</span>, <span class="fl">13.3</span>, <span class="fl">11.6</span>, <span class="fl">14.7</span>, <span class="fl">12.6</span>, <span class="fl">13.9</span>, <span class="fl">16.9</span>, <span class="fl">14.4</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_growthmodel</span>(grow_K_linear,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="fu">c</span>(<span class="at">y0 =</span> <span class="fl">0.1</span>, <span class="at">mumax =</span> <span class="fl">0.2</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">dK =</span> .<span class="dv">1</span>), <span class="at">time =</span> x, <span class="at">y =</span> y)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Parameters:
##       Estimate Std. Error t value Pr(&gt;|t|)    
## y0     0.53286    0.55248   0.964 0.349157    
## mumax  0.18124    0.07555   2.399 0.028988 *  
## K      7.76895    1.65802   4.686 0.000248 ***
## dK     0.08490    0.02375   3.575 0.002529 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.442 on 16 degrees of freedom
## 
## Parameter correlation:
##            y0   mumax       K      dK
## y0     1.0000 -0.9211  0.5040 -0.3791
## mumax -0.9211  1.0000 -0.6911  0.5596
## K      0.5040 -0.6911  1.0000 -0.9528
## dK    -0.3791  0.5596 -0.9528  1.0000</code></pre>
</div>
<div id="inline-c-code-with-package-code" class="section level1">
<h1>5. Inline C code with package cOde</h1>
<p>A numerical simulation of ODE models can sometimes be slow, so we may
be tempted to speed it up. This is indeed possible with <em>compiled
code</em>, i.e. the model is written in another programming language
(Fortran or C) that are faster compared to R. Several methods exist how
this can be done, see for example <span class="citation">Soetaert,
Petzoldt, and Setzer (2010)</span> or <span class="citation">Kneis
(2016)</span> and <span class="citation">Kneis, Petzoldt, and Berendonk
(2017)</span>. In the following, we use a method that allows <em>inline
code</em>, i.e. direkt integration of C code in the R script using
package <strong>cOde</strong> <span class="citation">(Kaschek
2016)</span>.</p>
<p>Note, however, that compiled code needs the necessary C (and/or
Fortran) compilers and some additional developer tools. These are often
installed on Linux systems by default, whereas the Windows toolset
available from <a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a> needs an
additional installation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## The following example shows how to use compiled growth models</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## from inline code, by using the &#39;cOde&#39; package of Daniel Kaschek</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: This example needs the R development tools.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  - suitable compilers on Linux and Mac</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  - Rtools on Windows from https://cran.r-project.org/bin/windows/Rtools/</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;growthrates&quot;</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;cOde&quot;</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## define a system of ODEs and compile it --------------------------------------</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ode_K_linear <span class="ot">&lt;-</span> <span class="fu">funC</span>(<span class="fu">c</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="st">&quot;mumax * y * (1-y/K)&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="st">&quot;dK&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>yini <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">y =</span> <span class="dv">1</span>, <span class="at">K =</span> <span class="dv">10</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">=</span> <span class="fu">c</span>(<span class="at">mumax =</span> <span class="fl">0.1</span>, <span class="at">dK =</span> <span class="fl">0.05</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="do">## run the model</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">odeC</span>(yini, <span class="at">times =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, ode_K_linear, <span class="at">parms =</span> parms)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="do">## generate artificial test data with normal distributed noise</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">odeC</span>(yini, x, ode_K_linear, parms)[, <span class="st">&quot;y&quot;</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(x)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="do">## create a &quot;growthmodel&quot; with interfaces compatible to package growthrates</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="do">## It is essential to use consistent names for parameters and initial values!</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>grow_K_linear <span class="ot">&lt;-</span> <span class="cf">function</span>(time, parms, ...) {</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  init    <span class="ot">&lt;-</span> parms[<span class="fu">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;K&quot;</span>)]  <span class="co"># initial values</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(init) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;K&quot;</span>)      <span class="co"># force names</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">odeC</span>(init, time, ode_K_linear, parms)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="do">## convert this to an object, (maybe needed by future extensions)</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>grow_K_linear <span class="ot">&lt;-</span> <span class="fu">growthmodel</span>(grow_K_linear, <span class="at">pnames =</span> <span class="fu">c</span>(<span class="st">&quot;y0&quot;</span>, <span class="st">&quot;mumax&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;dK&quot;</span>))</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Test the growthmodel</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns with names &#39;time&#39; and &#39;y&#39; are mandatory.</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">grow_K_linear</span>(<span class="at">time =</span> x, <span class="fu">c</span>(<span class="at">y0 =</span> <span class="dv">1</span>, <span class="at">mumax =</span> <span class="fl">0.1</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">dK =</span> <span class="fl">0.1</span>)))</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit the model ---------------------------------------------------------------</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_growthmodel</span>(grow_K_linear,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="fu">c</span>(<span class="at">y0 =</span> <span class="dv">1</span>, <span class="at">mumax =</span> <span class="fl">0.1</span>, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">dK =</span> <span class="fl">0.1</span>), <span class="at">time =</span> x, <span class="at">y =</span> y)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Unload DLL and cleanup ------------------------------------------------------</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="do">## DLL creation should ideally be directed to a temporary directory.</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>dll <span class="ot">&lt;-</span> <span class="fu">paste</span>(ode_K_linear, .Platform<span class="sc">$</span>dynlib.ext, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.unload</span>(dll)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(dll)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="fu">paste</span>(ode_K_linear, <span class="st">&quot;.c&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="fu">paste</span>(ode_K_linear, <span class="st">&quot;.o&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span></code></pre></div>
</div>
<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>Many thanks to Claudia Seiler for the data set, to David Kneis for
fruitful discussions, to Daniel Kaschek for his <strong>cOde</strong>
package, and to the R Core Team <span class="citation">(R Core Team
2015)</span> for developing and maintaining <strong>R</strong>. This
documentation was written using <strong>knitr</strong> <span class="citation">(Xie 2014)</span> and <strong>rmarkdown</strong> <span class="citation">(Allaire et al. 2015)</span>.</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rmarkdown" class="csl-entry">
Allaire, JJ, Joe Cheng, Yihui Xie, Jonathan McPherson, Winston Chang,
Jeff Allen, Hadley Wickham, and Rob Hyndman. 2015. <em><span class="nocase">rmarkdown</span>: Dynamic Documents for r</em>. <a href="https://CRAN.R-project.org/package=rmarkdown">https://CRAN.R-project.org/package=rmarkdown</a>.
</div>
<div id="ref-Kaschek2016" class="csl-entry">
Kaschek, Daniel. 2016. <em><span class="nocase">c</span>ode: Automated
<span>C</span> Code Generation for Use with the <span class="nocase">d</span>eSolve and <span class="nocase">b</span>vpSolve
Packages</em>. <a href="https://CRAN.R-project.org/package=cOde">https://CRAN.R-project.org/package=cOde</a>.
</div>
<div id="ref-Kneis2016" class="csl-entry">
Kneis, David. 2016. <em><span class="nocase">r</span>odeo: Handling of
ODE-Models as r Objects</em>. <a href="https://github.com/dkneis/rodeo">https://github.com/dkneis/rodeo</a>.
</div>
<div id="ref-Kneis2017" class="csl-entry">
Kneis, David, Thomas Petzoldt, and Thomas U. Berendonk. 2017. <span>“An
r-Package to Boost Fitness and Life Expectancy of Environmental
Models.”</span> <em>Environmental Modelling &amp; Software</em> 96:
123–27. https://doi.org/<a href="https://doi.org/10.1016/j.envsoft.2017.06.036">https://doi.org/10.1016/j.envsoft.2017.06.036</a>.
</div>
<div id="ref-RCore2015" class="csl-entry">
R Core Team. 2015. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-Soetaert2010c" class="csl-entry">
Soetaert, Karline, Thomas Petzoldt, and R. Woodrow Setzer. 2010.
<span>“<span class="nocase">Solving Differential Equations in
R</span>.”</span> <em>The R Journal</em> 2 (2): 5–15. <a href="https://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf">https://journal.r-project.org/archive/2010-2/RJournal_2010-2_Soetaert~et~al.pdf</a>.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“<span class="nocase">knitr</span>: A
Comprehensive Tool for Reproducible Research in <span>R</span>.”</span>
In <em>Implementing Reproducible Computational Research</em>, edited by
Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman;
Hall/CRC. <a href="https://www.crcpress.com/product/isbn/9781466561595">https://www.crcpress.com/product/isbn/9781466561595</a>.
</div>
</div>
<hr />
<p><strong>Copyright and original author:</strong> <a href="https://github.com/tpetzoldt">tpetzoldt</a>, 2022-10-03</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
