---
title: "Pipes in R"
author: "Thomas Petzoldt"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "useR-fonts", "xaringan-themer.css", "tp_xaringan_scrollable.css"]
    seal: false
    lib_dir: libs
    nature:
      beforeInit: "tp_xaringan.js"
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      self_contained: false
      navigation:
        scroll: false  
  html_document:
    toc: yes
    number_sections: yes
    fig.caption: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  word_document:
    toc: no
  pdf_document:
    toc: no
    number_sections: yes
bibliography: bib.bib
csl: apa
always_allow_html: true
---


class: center, middle, title-slide

background-image: url("fig/water_tud_r_oer_by.png")

background-size: cover


<!-- Own title slide / -->

# A Small Introduction to Pipes in R

#### Thomas Petzoldt

.small[Version `r Sys.Date()`, source code freely available from https://github.com/tpetzoldt/tpetzoldt.github.io/)]


--- 

Use cursor keys for navigation, press .red["O"] for a slide .red[O]verview

<!--
Verbatim code embedding:
https://themockup.blog/posts/2021-08-27-displaying-verbatim-code-chunks-in-xaringan-presentations/
-->

<!--- Setup ------------------------------------------------------------------->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width=14, 
                      fig.height=6, dev.args = list(pointsize=20))
#library("dplyr")
#library("tidyr")
library("kableExtra")
library("DiagrammeR")
mypar <- list(las = 1, cex.lab = 1.4, cex.axis=1.4, lwd = 2)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library("xaringanthemer")
style_mono_light(
  title_slide_text_color = "#00305d",
  link_color = "#006ab2"#,
  #white_color = "#FFFFFF"
)
```

```{r xaringanExtra, include=FALSE, warnint=FALSE}
#library("xaringanExtra")
xaringanExtra::use_webcam()
xaringanExtra::use_tile_view()
#xaringanExtra::use_scribble()
#xaringanExtra::use_freezeframe()
#xaringanExtra::use_progress_bar(color = "#0051BA", location = "top")
```

<!-- citations work differently with xaringan compared to @Markdown / -->
```{r, load_refs, include=FALSE, cache=FALSE}
library("RefManageR")
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "markdown",
           dashed = FALSE)
bib <- ReadBib("./bib.bib", check = FALSE)
```
<!--- End of Setup ------------------------------------------------------------>

---

## Pipes ...

---

## Classical styles

* intermediate variables

* nested parentheses

---

## Packages

* dplyr:
* tidyr:
* lubridate:
* ggplot:

---

## dplyr pipes and native pipes

* Pipes from package **dplyr**: `%>%` (also called **magrittr**-style pipes)
* Native pipes since R version 4.1: `|>` have some advantages, but are still less popular
* Native and dplyr pipes are mostly compatible, but not by 100%.

---

## `mutate`

```{r}
library(readxl)
library(dplyr)

## read data directly from an Excel table
fruits  <- read_excel("data/clementines_2019.xlsx", "Fruits")

## boxplot and summary statistics
boxplot(weight ~ brand, data=fruits)

## an example of "modern R" with package dplyr and the pipe operator
## extend this to calculate also min, max and median
summary_stats <-
  fruits %>% group_by(brand) %>%
    summarize(mean = mean(weight),
              sd   = sd(weight),
              cv   = sd(weight)/mean(weight),
              n    = length(weight))
```



---
## `filter` and `select`


---
## Database operations

* `left_join`

```{r}
## read another table with the meta data
brands  <- read_excel("data/clementines_2019.xlsx", "Brands")

## database operation: join tables together
alldata <- left_join(fruits, brands)
```


---
## `pivot_longer` and `pivot_wider`

---
## `group_by` and `summarize`

---
## `<tidy-select>`

* only a few examples

---
## Further reading

Start with the [dplyr cheat sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf):




For more details, see <https://dplyr.tidyverse.org/>.

---

## Acknowledgemt
<br></br><br></br><br></br>
These slides were created with [R](https://www.r-project.org), [RStudio](https://rstudio.com), [rmarkdown](https://rmarkdown.rstudio.com/), [knitr](https://CRAN.R-project.org/package=knitr) and [xaringan](https://github.com/yihui/xaringan).

`r NoCite(bib, "xaringan")`
`r NoCite(bib, c("RCore2022", "RStudio", "R-knitr"))`

---


## References


```{r refs, echo=FALSE, results="asis"}
PrintBibliography(bib)
```

